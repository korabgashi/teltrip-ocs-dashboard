import { NextResponse } from 'next/server';const API_URL='https://ocs-api.esimvault.cloud/v1';const OCS_TOKEN=process.env.OCS_TOKEN;const MOCK={result:{subscriberId:1001,sessions:[{started:'2025-08-13T09:00:00Z',ended:'2025-08-13T10:00:00Z',usedBytes:234567890}],totalUsedBytes:234567890}};export async function POST(req){try{const body=await req.json();const {subscriberId}=body||{};if(!subscriberId)return NextResponse.json({error:'Missing subscriberId'},{status:400});if(!OCS_TOKEN){return NextResponse.json(MOCK)}const ocsBody={getSubscriberUsage:{subscriberId:Number(subscriberId)}};const r=await fetch(`${API_URL}?token=${OCS_TOKEN}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(ocsBody),cache:'no-store'});if(!r.ok){const text=await r.text();return NextResponse.json({error:`OCS error: ${r.status} - ${text.slice(0,300)}`},{status:502})}const data=await r.json();return NextResponse.json(data)}catch(e){return NextResponse.json({error:String(e)},{status:500})}}